# FunnelCanary v0.0.7 测试用例

## 工具边界测试用例

### Read 工具

| ID | 场景 | 输入 | 预期结果 | 状态 |
|----|------|------|----------|------|
| R01 | 正常小文件 | < 100KB 文件 | 成功，返回内容 | ✅ |
| R02 | 刚好 100KB | 100,000 bytes | 成功 | ✅ |
| R03 | 超过 100KB | 100,001 bytes | 失败："文件过大" | ✅ |
| R04 | 文件不存在 | 无效路径 | 失败："文件不存在" | ✅ |
| R05 | 目录而非文件 | 目录路径 | 失败："不是文件" | ✅ |
| R06 | 无权限 | chmod 000 | 失败："权限不足" | ✅ |
| R07 | 二进制文件 | .bin 文件 | 成功，带替换字符 | ✅ |
| R08 | UTF-8 中文 | 中文内容 | 成功，内容正确 | ✅ |
| R09 | 空路径 | "" | 失败 | ✅ |

### Glob 工具

| ID | 场景 | 输入 | 预期结果 | 状态 |
|----|------|------|----------|------|
| G01 | 简单模式 | *.py | 匹配顶层 .py | ✅ |
| G02 | 递归模式 | **/*.py | 匹配所有 .py | ✅ |
| G03 | 无匹配 | *.xyz | "未找到匹配" | ✅ |
| G04 | 恰好 100 结果 | 100 文件 | 不截断 | ✅ |
| G05 | 超过 100 结果 | 150 文件 | 截断，显示提示 | ✅ |
| G06 | 路径不存在 | /nonexistent | 失败："路径不存在" | ✅ |
| G07 | 文件非目录 | 文件路径 | 失败："不是目录" | ✅ |
| G08 | 排序验证 | 多文件 | 按修改时间降序 | ✅ |

### Bash 工具

| ID | 场景 | 输入 | 预期结果 | 状态 |
|----|------|------|----------|------|
| B01 | 简单命令 | echo hello | 成功："hello" | ✅ |
| B02 | rm -rf / | 危险命令 | 阻止："安全检查失败" | ✅ |
| B03 | rm -rf ~ | 危险命令 | 阻止 | ✅ |
| B04 | Fork bomb | :(){:\|:&};: | 阻止 | ✅ |
| B05 | mkfs | 磁盘操作 | 阻止 | ✅ |
| B06 | 大小写混合 | RM -RF / | 阻止 | ✅ |
| B07 | 默认超时 | echo | timeout=30 | ✅ |
| B08 | 超时上限 | timeout=600 | 截断为 300 | ✅ |
| B09 | 负数超时 | timeout=-1 | 使用默认 30 | ✅ |
| B10 | 超时触发 | sleep 10, timeout=1 | 失败："超时" | ✅ |
| B11 | 非零返回 | exit 1 | 失败 | ✅ |
| B12 | stderr 输出 | ls /nonexistent | 包含 [stderr] | ✅ |

### python_exec 工具

| ID | 场景 | 输入 | 预期结果 | 状态 |
|----|------|------|----------|------|
| P01 | 简单 print | print('hi') | 成功："hi" | ✅ |
| P02 | math 模块 | math.sqrt(16) | 成功："4.0" | ✅ |
| P03 | datetime 模块 | datetime.now() | 成功 | ✅ |
| P04 | json 模块 | json.dumps({}) | 成功 | ✅ |
| P05 | 无输出 | x = 1 | 成功："无输出" | ✅ |
| P06 | 禁止 import os | import os | 失败 | ✅ |
| P07 | 禁止 open() | open('file') | 失败 | ✅ |
| P08 | 禁止 eval() | eval('1') | 失败 | ✅ |
| P09 | 语法错误 | print( | 失败：SyntaxError | ✅ |
| P10 | 运行时错误 | 1/0 | 失败：ZeroDivisionError | ✅ |
| P11 | 内置函数 | len([1,2,3]) | 成功："3" | ✅ |

### web_search 工具

| ID | 场景 | 输入 | 预期结果 | 状态 |
|----|------|------|----------|------|
| W01 | 正常搜索 | python tutorial | 成功，返回结果 | ✅ |
| W02 | 结果限制 | 任意 | 最多 5 条 | ✅ |
| W03 | 无结果 | xyznonexistent | 成功，confidence=0.5 | ✅ |
| W04 | 网络错误 | (mock) | 失败："搜索失败" | ✅ |
| W05 | 超时 | (mock) | 失败 | ✅ |
| W06 | TTL 验证 | 任意 | ttl_seconds=3600 | ✅ |

### read_url 工具

| ID | 场景 | 输入 | 预期结果 | 状态 |
|----|------|------|----------|------|
| U01 | 正常页面 | 有效 URL | 成功，提取内容 | ✅ |
| U02 | 内容超长 | > 4000 字符 | 截断 + "已截断" | ✅ |
| U03 | 空页面 | 只有标签 | 成功，confidence=0.3 | ✅ |
| U04 | HTTP 404 | 无效 URL | 失败："读取URL失败" | ✅ |
| U05 | SSL 错误 | (mock) | 失败 | ✅ |
| U06 | 超时 | (mock) | 失败 | ✅ |
| U07 | 重定向 | (mock) | 跟随重定向 | ✅ |
| U08 | TTL 验证 | 任意 | ttl_seconds=7200 | ✅ |

### ask_user 工具

| ID | 场景 | 输入 | 预期结果 | 状态 |
|----|------|------|----------|------|
| A01 | 正常输入 | "answer" | 成功，content="answer" | ✅ |
| A02 | 空输入 | "" | 成功，content="" | ✅ |
| A03 | EOF (Ctrl+D) | EOFError | 失败："用户取消输入" | ✅ |
| A04 | Ctrl+C | KeyboardInterrupt | 失败："用户取消输入" | ✅ |
| A05 | 置信度 | 任意 | confidence=0.8 | ✅ |
| A06 | 无 TTL | 任意 | ttl_seconds=None | ✅ |

## Agent 测试用例

### 任务完成度测试

| ID | 场景 | 输入问题 | 成功标准 | 状态 |
|----|------|---------|----------|------|
| TC01 | 简单计算 | "1+1等于多少" | 返回正确答案 2 | ✅ |
| TC02 | 工具调用 | "计算2+2" | 调用 python_exec | ✅ |
| TC03 | 多步骤 | "计算并求和" | 完成多个步骤 | ✅ |

### 工具调用正确性

| ID | 场景 | 输入 | 预期工具调用 | 状态 |
|----|------|------|-------------|------|
| TC01 | 计算触发 | "计算15的平方" | python_exec | ✅ |
| TC02 | 文件读取 | "读取文件 xxx" | Read | ✅ |
| TC03 | 文件搜索 | "查找 Python 文件" | Glob | ✅ |

### 降级机制测试

| ID | 场景 | 条件 | 预期降级级别 | 状态 |
|----|------|------|-------------|------|
| D01 | 高置信度 | 多个高质量观测 | FULL_ANSWER | ✅ |
| D02 | 中置信度 | 部分观测 | PARTIAL_WITH_UNCERTAINTY | ✅ |
| D03 | 低置信度 | 仅用户输入 | REQUEST_MORE_INFO | ✅ |
| D04 | 无观测 | 无任何观测 | REFUSE | ✅ |
| D05 | 观测过期 | TTL 过期 | REQUEST_MORE_INFO | ✅ |

## 测试统计

| 类别 | 用例数 | 状态 |
|------|--------|------|
| Read 工具 | 9 | ✅ |
| Glob 工具 | 8 | ✅ |
| Bash 工具 | 12 | ✅ |
| python_exec 工具 | 11 | ✅ |
| web_search 工具 | 6 | ✅ |
| read_url 工具 | 8 | ✅ |
| ask_user 工具 | 6 | ✅ |
| **单元测试总计** | **60** | ✅ |
| 集成测试 | 15+ | ✅ |
| Agent 测试 | 15+ | ✅ |
| **总计** | **90+** | ✅ |
